<%@ page language="java" contentType="text/html; charset=utf-8"
	pageEncoding="utf-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib prefix="sec" uri="/WEB-INF/tags/shiro.tld"%>
<%@taglib prefix="pt6" uri="/WEB-INF/tags/platform6.tld"%>
<%@ page import="avicit.platform6.commons.utils.ViewUtil"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type"  content="text/html; charset=utf-8">
<meta http-equiv="Pragma" 	     content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache"> 

<!-- ControllerPath = "discussion_manage/structuralrelationship/StructuralRelationshipController/StructuralRelationshipInfo" -->
<title>tree</title>
<base href="<%=ViewUtil.getRequestPath(request)%>">
</head>
<jsp:include page="/avicit/platform6/component/common/EasyUIJsInclude.jsp"></jsp:include>
<jsp:include page="/avicit/discussion_manage/structuralrelationship/ztreeLayuiInclude.jsp"></jsp:include>
<script type="text/javascript">
	 var setting = {
		async: {
		 	autoParam:["id"],
			dataType:"json",
			enable: true,
			type:"get",
			url:"platform/discussion_manage/structuralrelationship/StructuralRelationshipController/searchVciZtreeByStrId/ED2BC48E564F4D1484672D787F2F01EF"
		},
		data: {
			simpleData: {
				enable: true
			}
		},
		callback: {
			onClick: zTreeOnClick,
		},
		view: {
			fontCss: getFontCss,
			nameIsHTML: true
		}
	};
	function getFont(treeId, node) {
		return node.font ? node.font : {};
	}
	
	//初始化树
	$(function(){
		$.fn.zTree.init($("#tree"), setting);
		setTimeout(selectNodeById,100);
	});
	
	function selectNodeById(){
		var zTree = $.fn.zTree.getZTreeObj("tree");
		var selecrNode = zTree.getNodeByParam("id", 'ED2BC48E564F4D1484672D787F2F01EF');
		zTree.selectNode(selecrNode);
	};
	
	//初始化选择根节点
	window.onload = function(){
		var zTree = $.fn.zTree.getZTreeObj("tree");
		var pn = zTree.getNodeByParam("pId", "-1");
		zTree.selectNode(pn);
	};
	
	
	//获取选择节点数据
	var selectNode=null;
	function zTreeOnClick(event, treeId, treeNode) {
		getDgStructuralRelationship(treeNode.id);
		selectNode = treeNode;
	};
	
	//通过零件查询单条记录
	function getDgStructuralRelationship(id){
		$("#dgStructuralRelationship").datagrid('uncheckAll').datagrid('unselectAll').datagrid('clearSelections');
		$("#dgStructuralRelationship").datagrid("load",{"id":id});
	};
	
	function getFontCss(treeId, treeNode) {
		return (!!treeNode.highlight) ? {color:"#A60000", "font-weight":"bold"} : {color:"#333", "font-weight":"normal"};
	}
	function formateclassType(value) {
		return Platform6.fn.lookup.formatLookupType(value,
				structuralRelationship.classType);
	}
	function formatestatus(value) {
		return Platform6.fn.lookup.formatLookupType(value,
				structuralRelationship.status);
	}
	//定位节点
	function searchNodes(value){
		var zTree = $.fn.zTree.getZTreeObj("tree");
 		if(value != null && value != ""){
 			var nodeList = zTree.getNodesByParamFuzzy("name", value);
 			updateAllNode(true,nodeList,zTree);
    	}
	};
	
	//定位节点
	function onClickSearchButton(){
		var value = $("#searchWord").val();
		searchNodes(value);
	};
</script>
</head>
<body>
    <div class="easyui-layout" fit="true">
		<div data-options="region:'west',split:true,title:'vci树结构'" style="width: 250px"
			<ul id="tree" class="ztree"></ul>
		</div>
	    <div data-options="region:'center',split:true" style="padding: 0px; overflow: auto;">
					<table id="dgStructuralRelationship"  class="easyui-datagrid"  
				data-options="
					fit: true,
					border: false,
					url:'platform/discussion_manage/structuralrelationship/StructuralRelationshipController/getDgStructuralRelationship.json',
					rownumbers: true,
					animate: true,
					collapsible: false,
					fitColumns: true,
					autoRowHeight: false,
					idField :'id',
					method:'get',
					singleSelect: true,
					checkOnSelect: true,
					selectOnCheck: false,
					pagination:true,
					pageSize:dataOptions.pageSize,
					pageList:dataOptions.pageList,
					striped:true">
				<thead>
					<tr>
						<th data-options="field:'id', align:'center',checkbox:true" width="200">表主键</th>
						<th data-options="field:'className', align:'center'" 	 width="220">讨论标题</th>
						<th data-options="field:'classCode', align:'center'" 	 width="220">科室或专业</th>
						<th data-options="field:'classType', align:'center'"	 width="220">发布时间</th>
						<th data-options="field:'status', align:'center'" 		 width="220">评论数量</th>
						<!-- <th data-options="field:'edition',  align:'center'" 	 width="150">版本</th>
						<th data-options="field:'designerName', align:'center'"	 width="150">设计者</th> -->
					</tr>
				</thead>
			</table>
	  	</div>
	  </div>
</body>
</html>