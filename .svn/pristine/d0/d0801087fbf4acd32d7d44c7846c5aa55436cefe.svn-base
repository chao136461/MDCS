<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="avicit.discussion_manage.modelInterveneCheck.dao.SynchronousInterveneDataDAO">

<!--  根据classCode得到零件id  -->
<select id="findStrIdByClassCode" parameterType="java.lang.String" resultType="java.lang.String">

	select t.id from mdcs.structure_manage t where t.class_code = #{classCode,jdbcType=VARCHAR} and rownum = 1 

</select>

<!-- 根据strId和instanceNumber得到零件parentId -->
<select id="findParentIdByStrId" parameterType="java.lang.String" resultType="java.lang.String">

	select t.parent_str_id from mdcs.structural_relationship t where t.str_id = #{strId,jdbcType=VARCHAR}  and t.instancenumber = #{instanceNumber,jdbcType=VARCHAR} and rownum = 1 

</select>

<!-- 查询模型干涉表是否存在该零件信息 -->
<select id="findInterveneIdCount" parameterType="java.lang.String" resultType="java.lang.Integer">

	select count(1) from mdcs.model_intervene_check t where t.strid = #{strId,jdbcType=VARCHAR} and t.instance_number = #{instanceNumber,jdbcType=VARCHAR}

</select>


<!--模型干涉表存不在该零件信息则新增 -->
<insert id="insertResolveInterveneXmlData" parameterType="avicit.discussion_manage.modelInterveneCheck.dto.InterveneDTO">
	insert into mdcs.model_intervene_check(
		   id,
		   strid,
		   parent_id,
		   jixing,
		   class_code,
		   instance_number,
		   check_time,
		   result,
		   description,
		   created_by,
		   creation_date,
		   last_updated_by,
		   last_update_date,
		   last_update_ip,
		   version)
   values(#{id,jdbcType=VARCHAR},
		  #{strId,jdbcType=VARCHAR},
		  #{parentId,jdbcType=VARCHAR},
		  #{jixing,jdbcType=VARCHAR},
		  #{classCode,jdbcType=VARCHAR},
		  #{instanceNumber,jdbcType=VARCHAR},
		  #{checkTime,jdbcType=VARCHAR},
		  #{result,jdbcType=VARCHAR},
		  #{description,jdbcType=VARCHAR},
		  #{createdBy,jdbcType=VARCHAR},
		  #{creationDate},
		  #{lastUpdatedBy,jdbcType=VARCHAR},
		  #{lastUpdateDate},
		  #{lastUpdateIp,jdbcType=VARCHAR},
		  #{version,jdbcType=DECIMAL})
</insert>

<!--模型干涉表存在该零件信息则更新 -->
<update id="updateInterveneDataByStrId" parameterType="avicit.discussion_manage.modelInterveneCheck.dto.InterveneDTO">	
	update mdcs.model_intervene_check t set 
	   t.parent_id = 		#{parentId,jdbcType=VARCHAR},
	   t.instance_number =  #{instanceNumber,jdbcType=VARCHAR},
	   t.check_time = 		#{checkTime,jdbcType=VARCHAR},
	   t.result =			#{result,jdbcType=VARCHAR},
	   t.description = 		#{description,jdbcType=VARCHAR},  
	   t.created_by = 		#{createdBy,jdbcType=VARCHAR},
	   t.creation_date=     #{creationDate},
	   t.last_updated_by =  #{lastUpdatedBy,jdbcType=VARCHAR},
	   t.last_update_date = #{lastUpdateDate} ,
	   t.last_update_ip =   #{lastUpdateIp,jdbcType=VARCHAR},
	   t.version =          #{version,jdbcType=DECIMAL}   
	where t.strid = #{strId,jdbcType=VARCHAR}  and t.instance_number = #{instanceNumber,jdbcType=VARCHAR}
</update>


</mapper>