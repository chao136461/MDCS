<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="avicit.discussion_manage.informationstatistics.dao.InformationStatisticsDao">
<!--零件   装配件的数量 -->
<select id="searchStructureManage"  resultType="java.util.Map">
 select m.class_type type,count(t.id) num 
         from DISCUSSION_MANAGE t
         left join STRUCTURE_MANAGE m
         on m.id = t.str_id
         where m.class_type in(1,2)
         group by m.class_type
</select>
<!--建议关闭状态的统计图形   已关闭  未关闭   争议性关闭-->
<select id="searchSuggestionClosed"  resultType="java.util.Map">
	select count(t.id) num,t.status status
    from PROPOSAL_MANAGE t
    where t.status in(0,1,2)
	  group by t.status
</select>
 <!--审查讨论   审查确认   审查完成的统计图形-->
<select id="searchAuditOpinion"  resultType="java.util.Map">
	select  sum(class_type)class_type,sum(m2andm3) m2andm3, sum(m4)m4, sum(m5)m5,sum(class_type2)class_type2,sum(m2andm32) m2andm32, sum(m42)m42, sum(m52)m52
from (  select count(class_type)class_type, 0 m2andm3, 0 m4,0 m5,0 class_type2,0 m2andm32, 0  m42, 0 m52 from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id

where t1.class_type='1'
union all

select 0 class_type, count(class_type) m2andm3, 0 m4,0 m5,0 class_type2,0 m2andm32, 0  m42, 0 m52 from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id
where  t1.class_type='1'
and t1.status in(2,3)


union all

select 0 class_type,0 m2andm3, count(class_type) m4,0 m5,0 class_type2,0 m2andm32, 0  m42, 0 m52 from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id
where  t1.class_type='1'
and t1.status='4'


union all

select 0 class_type,0 m2andm3, 0  m4,count(class_type)m5,0 class_type2,0 m2andm32, 0  m42, 0 m52 from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id
where  t1.class_type='1'
and t1.status='5'

union all

 select 0 class_type,0 m2andm3, 0  m4,0 m5,count(class_type)class_type2, 0 m2andm32, 0 m42,0 m52 from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id

where t1.class_type='2'
union all

select 0 class_type,0 m2andm3, 0  m4,0 m5,0 class_type2, count(class_type) m2andm32, 0 m42,0 m52 from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id
where  t1.class_type='2'
and t1.status in(2,3)


union all

select 0 class_type,0 m2andm3, 0  m4,0 m5,0 class_type2,0 m2andm32, count(class_type) m42,0 m52 from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id
where  t1.class_type='2'
and t1.status='4'


union all

select 0 class_type,0 m2andm3, 0  m4,0 m5,0 class_type2,0 m2andm32, 0  m42,count(class_type)m52  from DISCUSSION_MANAGE t2 left join
  STRUCTURE_MANAGE t1
  on 
t1.id = t2.str_id
where  t1.class_type='2'
and t1.status='5'

) t

</select> 
<select id="">
SELECT TEMP.WORKSHOP_ID
     FROM (SELECT T.STR_ID, T.WORKSHOP_ID
           FROM FACTORY_COMPLEX T
           GROUP BY T.WORKSHOP_ID, T.STR_ID
           UNION ALL
           SELECT T.STR_ID, T.STD_ID AS WORKSHOP_ID
           FROM MAJOR_MANAGE T
           GROUP BY T.STD_ID, T.STR_ID) TEMP
           WHERE 1 = 1
           and TEMP.STR_ID in (
           select t.str_id from STRUCTURAL_RELATIONSHIP t where t.instance_id='-1' group by t.str_id);
</select>

</mapper>
