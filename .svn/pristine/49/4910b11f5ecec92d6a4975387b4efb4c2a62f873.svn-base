<%@ page language="java" contentType="text/html; charset=utf-8"
	pageEncoding="utf-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@taglib prefix="sec" uri="/WEB-INF/tags/shiro.tld"%>
<%@taglib prefix="pt6" uri="/WEB-INF/tags/platform6.tld"%>
<%@ page import="avicit.platform6.commons.utils.ViewUtil"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type"  content="text/html; charset=utf-8">
<meta http-equiv="Pragma" 	     content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache"> 
<!-- ControllerPath = "discussion_manage/structuralrelationship/StructuralRelationshipController/StructuralRelationshipInfo" -->
<title>tree</title>
<base href="<%=ViewUtil.getRequestPath(request)%>">
<% String strid = request.getParameter("id")==null?"":request.getParameter("id"); %>
</head>
<jsp:include page="/avicit/platform6/component/common/EasyUIJsInclude.jsp"></jsp:include>
<jsp:include page="/avicit/discussion_manage/structuralrelationship/ztreeLayuiInclude.jsp"></jsp:include>
<script type="text/javascript">
	 var strid ='<%=strid%>';
	 var setting = {
		async: {
		 	autoParam:["id"],
			dataType:"json",
			enable: true,
			type:"get",
			url:"platform/discussion_manage/structuralrelationship/StructuralRelationshipController/searchVciZtreeByStrId/"+strid,
		},
		data: {
			simpleData: {
				enable: true
			}
		},
		callback: {
			onClick: zTreeOnClick,
		}
	};
	function getFont(treeId, node) {
		return node.font ? node.font : {};
	}
	
	//初始化树
	$(function(){
		$.fn.zTree.init($("#tree"), setting);
		setTimeout(selectNodeById,100);
		findDiscussionDate();
	});
	
	//选中节点
	function selectNodeById(){
		var zTree = $.fn.zTree.getZTreeObj("tree");
		var selecrNode = zTree.getNodeByParam("id", strid);
		zTree.selectNode(selecrNode);
	};
	
	//初始化datagrid
	function findDiscussionDate(){
		$("#dgDiscussion").datagrid({
			url:'platform/discussion_manage/discussionmanage/DiscussionManageController/selectDiscussionData/'+ strid
		});
	};
	
	//获取选择节点数据
	var selectNode=null;
	function zTreeOnClick(event, treeId, treeNode) {
		getDgStructuralRelationship(treeNode.id);
		selectNode = treeNode;
	};
	function formateDate(value, row, index) {
		return formate(value);
	}
	function formate(value){
		if(value){
			return new Date(value).format("yyyy-MM-dd");
		}
		return '';
	};
</script>
</head>
<body>
    <div class="easyui-layout" fit="true">
		<div data-options="region:'west',split:true,title:'vci树结构'" style="width: 250px"
			<ul id="tree" class="ztree"></ul>
		</div>
	    <div data-options="region:'center',split:true" style="padding: 0px; overflow: auto;">
					<table id="dgDiscussion"  class="easyui-datagrid"  
				data-options="
					fit: true,
					border: false,
					rownumbers: true,
					animate: true,
					collapsible: false,
					fitColumns: true,
					autoRowHeight: false,
					idField :'id',
					method:'post',
					singleSelect: true,
					checkOnSelect: true,
					selectOnCheck: false,
					pagination:true,
					pageSize:dataOptions.pageSize,
					pageList:dataOptions.pageList,
					striped:true">
				<thead>
					<tr>
						<th data-options="field:'id', align:'center',checkbox:true" width="20">表主键</th>
						<th data-options="field:'keShiZhuanYe', align:'center'" 	width="220">科室或专业</th>
						<th data-options="field:'title', align:'center'" 	 		width="220">讨论标题</th>
						<th data-options="field:'status', align:'center'" 		 	width="220">状态</th>
						<th data-options="field:'faBuPerson',  align:'center'" 	 	width="150">发布人</th>
						<th data-options="field:'date', align:'center',formatter:formateDate" width="220">发布时间</th>
					</tr>
				</thead>
			</table>
	  	</div>
	  </div>
</body>
</html>